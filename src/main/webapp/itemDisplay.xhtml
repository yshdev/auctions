<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>DailyAuctions - Item Display</title>
    </h:head>
    <h:body>
        <h:form style="float:right; font-size:120%">
            hi #{loggedUserBean.connectedUser.username}!
            <h:commandLink value="logout" action="#{loggedUserBean.logout()}"/>
        </h:form>
        <h:outputLink value="mainMenu.xhtml"
                      style="text-decoration: none; color:black;
                      font-size:200%">DailyAuctions</h:outputLink>
        <hr/>
        <h2>Item Display</h2>
        
        <h:panelGrid columns="1">
            <h:outputText style="font-size: 105%"
                          value="#{itemListBean.getChosenAuction().getTitle()}"/>
            <h:outputText style="font-size: 95%"
                          value="#{itemListBean.getChosenAuction().getCategory().getTitle()}"/>
            <h:outputText value="#{itemListBean.getChosenAuction().getDescription()}"/>
            <h:outputText value="Started at: #{itemListBean.getChosenAuction().getStartingTime()}
                          Will end at: #{itemListBean.getChosenAuction().getEndingTime()}"/>
            <h:outputText value="Number of bids so far: 
                          #{itemListBean.getChosenAuction().getBids().countItems()}"/>
            <h:outputText value="Starting bid: #{itemListBean.getChosenAuction().getStartingAmount()}
                          Last bid: #{itemListBean.getChosenAuction().getHighestBid().getAmmount()}"/>
            <hr/>
            <h:outputText rendered="#{itemListBean.getChosenAuction().isClosed}"
                          style="font-weight: bold" value="Auction is Closed!"/>
            <h:outputText rendered="#{itemListBean.getChosenAuction().isClosed and 
                                      itemListBean.getChosenAuction().getOwner() =
                                      loggedUserBean.connectedUser}"
                          value="Winner: #{itemListBean.getChosenAuction().getHighestBid().getBidder().getFirstName()}
                                #{itemListBean.getChosenAuction().getHighestBid().getBidder().getLastName()}
                                , #{itemListBean.getChosenAuction().getHighestBid().getBidder().getEmail()}"/>
            <h:outputText rendered="#{itemListBean.getChosenAuction().isClosed and 
                                      itemListBean.getChosenAuction().getOwner() =
                                      loggedUserBean.connectedUser}"
                          value="Winning bid: #{itemListBean.getChosenAuction().getHighestBid().getAmmount()}"/>
            <h:commandLink rendered="#{not itemListBean.getChosenAuction().isClosed and 
                                      itemListBean.getChosenAuction().getOwner() =
                                      loggedUserBean.connectedUser}"
                           value="Cancel Auction" action="#{itemListBean.cancelAuction()}"/>
        </h:panelGrid>
        not closed and not owner, bid
        <h:panelGrid columns="4"
                     rendered="#{not itemListBean.getChosenAuction().isClosed and 
                                 not (itemListBean.getChosenAuction().getOwner() =
                                 loggedUserBean.connectedUser)}">
            <h:outputText value="Minimal Bid: #{itemListBean.minBid()}$"/>
            <h:panelGroup/><h:panelGroup/><h:panelGroup/>
            <h:outputText value="Bid amount:"/>
            <h:inputText id="inputBid" required="true" requiredMessage="reqired"
                         binding="#{input}" validatorMessage="minimal bid is #{itemListBean.minBid()}">
                <f:validateDoubleRange minimum="#{itemListBean.minBid()}" />
            </h:inputText>
            <h:outputText value="$"/>
            <h:commandButton value="Make a Bid!"
                             action="#{itemListBean.newBid(input.value, loggedUserBean.connectedUser)}">
            </h:commandButton>
            <h:panelGroup/>
            <h:message for="inputBid" style="color:red"/>
        </h:panelGrid>
    </h:body>
</html>
